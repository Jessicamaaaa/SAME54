
# 目录

# 1.定时器/计数器框图
![images](https://github.com/yuchengstudio/SAME54/blob/master/Timer_Counter/pictures/timer002.jpg)

| 名称 | 英文描述 | 中文说明 | 
| :----- | :----- | :----- |
|CCx| Channel x Compare/Capture Value| X通道比较/捕捉器值|
|CCBUFx| Channel x Compare Buffer Value| x通道比较器缓存器值（有8-位模式，16-位模式，32-位模式）|


| 名称 | 描述 | 说明 | 
| :----- | :----- | :----- |
 | TOP | The counter reaches TOP when it becomes equal to the highest value in the count sequence. The TOP value can be the same as Period (PER)or the Compare Channel 0 (CC0) register value depending on the waveform generator mode in 48.6.2.6.1 Waveform Output Operations | 
 | ZERO | The counter is ZERO when it contains all zeroes |  
 | MAX | The counter reaches MAX when it contains all ones |  
 | UPDATE | The timer/counter signals an update when it reaches ZERO or TOP,depending on the direction settings.|
 | Timer | The timer/counter clock control is handled by an internal source |
 | Counter | The clock control is handled externally (e.g. counting external events) |
 | CC | For compare operations, the CC are referred to as “compare channels” For capture operations, the CC are referred to as “capture channels.”|


| 英文 | 中文 | 说明 | 
| :-------- | :----- | :----- |
| Each TC instance has up to two compare/capture channels (CC0 and CC1). | 每一个TC有两个比较或捕捉通道（CC0 和 CC1）|  |
| The counter in the TC can either count events from the Event System, or clock ticks of the GCLK_TCx clock, which may be divided by the prescaler.| TC中的计数器可用于记录来自事件系统的事件数，或者GCLK_TCx的频次，GCLK_TCx需要经过预分频器分频后才能被TC使用 ||
| The counter value is passed to the CCx where it can be either compared to user-defined values or captured.| 计时器的值传递给CCx寄存器，在这里计数器值将同用户定义的数值，或捕获预定事件的记录值进行比较||
| For optimized timing the CCx and CCBUFx registers share a common resource. When writing intoCCBUFx, lock the access to the corresponding CCx register (SYNCBUSY.CCX = 1) till the CCBUFx register value is not loaded into the CCx register (BUFVx == 1). Each buffer register has a buffer valid (BUFV) flag that indicates when the buffer contains a new value  | 为了优化定时，CCx和CCBUFx寄存器共享一个公共资源。 写入CCBUFx时，锁定对相应CCx寄存器（SYNCBUSY.CCX = 1）的访问，直到CCBUFx寄存器值未载入CCx寄存器（BUFVx == 1）。 每个缓冲寄存器都有一个缓冲区有效（BUFV）标志，指示缓冲区何时包含新值||
| The Counter register (COUNT) and the Compare and Capture registers with buffers (CCx and CCBUFx) can be configured as 8-, 16- or 32-bit registers, with according MAX values. Mode settings(CTRLA.MODE) determine the maximum range of the Counter register | 可以将计数器寄存器（COUNT）以及带有缓冲区（CCx和CCBUFx）的比较和捕捉寄存器配置为8位，16位或32位寄存器，并具有相应的MAX值。 模式设置（CTRLA.MODE）确定计数器寄存器的最大范围。||
| In 8-bit mode, a Period Value (PER) register and its Period Buffer Value (PERBUF) register are also available. The counter range and the operating frequency determine the maximum time resolution achievable with the TC peripheral. |  在8位模式下，周期值（PER）寄存器及其周期缓冲器值（PERBUF）寄存器也可用。 计数器范围和工作频率决定了TC外设可实现的最大时间分辨率。||
| The TC can be set to count up or down. Under normal operation, the counter value is continuously compared to the TOP or ZERO value to determine whether the counter has reached that value. On a comparison match the TC can request DMA transactions, or generate interrupts or events for the Event System |  TC可以设置为向上或向下计数。 在正常操作下，计数器值连续与TOP或ZERO值进行比较，以确定计数器是否达到该值。 在比较匹配时，TC可以请求DMA事务，或为事件系统生成中断或事件||
| In compare operation, the counter value is continuously compared to the values in the CCx registers. In case of a match the TC can request DMA transactions, or generate interrupts or events for the Event System. In waveform generator mode, these comparisons are used to set the waveform period or pulse width| 在比较操作中，计数器值不断与CCx寄存器中的值进行比较。 如果匹配，TC可以请求DMA事务，或为事件系统生成中断或事件。 在波形发生器模式下，这些比较用于设置波形周期或脉冲宽度||
| Capture operation can be enabled to perform input signal period and pulse width measurements, or to capture selectable edges from an IO pin or internal event from Event System.| 可以启用捕获操作来执行输入信号周期和脉冲宽度测量，或从IO引脚捕获可选边沿或从事件系统捕获内部事件。||


### 48.6.2 基本操作

#### 46.6.2.1. 初始化
以下寄存器是“启用保护”的，这意味着它们只能在TC禁用时写入（CTRLA.ENABLE = 0）：
```
• Control A register (CTRLA), except the Enable (ENABLE) and Software Reset (SWRST) bits
• Drive Control register (DRVCTRL)
• Wave register (WAVE)
• Event Control register (EVCTRL)
```
写“启用保护”位并设置CTRLA.ENABLE位可以在一个32位中执行访问CTRLA寄存器。 写“启用保护位”并清除CTRLA.ENABLE位不能在单个32位访问中执行。
在启用TC之前，相应外设必须做如下步骤的配置：

| 英文 | 中文 | 说明 | 
| :------ | :----- | :----- |
|1. Enable the TC bus clock (CLK_TCx_APB).| 1.使能TC总线时钟（CLK_TCx_APB）||
|2. Select 8-, 16- or 32-bit counter mode via the TC Mode bit group in the Control A register(CTRLA.MODE). The default mode is 16-bit..| 2.通过控制寄存器（CTRLA.MODE）中的TC模式位组选择8位，16位或32位计数器模式。 默认模式是16位。||
| 3. Select one wave generation operation in the Waveform Generation Operation bit group in the WAVE register (WAVE.WAVEGEN)|3.在WAVE寄存器（WAVE.WAVEGEN）中的波形产生操作位组中选择一个波形产生操作模式||
| 4.If desired, the GCLK_TCx clock can be prescaled via the Prescaler bit group in the Control A register (CTRLA.PRESCALER).– If the prescaler is used, select a prescaler synchronization operation via the Prescaler and Counter Synchronization bit group in the Control A register (CTRLA.PRESYNC).|4.如果需要，GCLK_TCx时钟可以通过控制寄存器A（CTRLA.PRESCALER）中的预分频比位组进行预分频。- 如果使用预分频器，请通过预分频器,及控制寄存器A（CTRLA.PRESYNC）中的计数器同步位组,选择一个分频异步操作。||
|5.If desired, select one-shot operation by writing a '1' to the One-Shot bit in the Control B Set register(CTRLBSET.ONESHOT).|5.如果需要，通过向控制B置位寄存器的One-Shot位写入'1'来选择单次操作（CTRLBSET.ONESHOT）。||
|6.If desired, configure the counting direction 'down' (starting from the TOP value) by writing a '1' to the Counter Direction bit in the Control B register (CTRLBSET.DIR).|6.如果需要，通过向控制B寄存器（CTRLBSET.DIR）中的计数器方向位写入'1'来配置计数方向'向下'（从TOP值开始）。||
|7.For capture operation, enable the individual channels to capture in the Capture Channel x Enable bit group in the Control A register (CTRLA.CAPTEN).|7.对于捕捉操作，在控制寄存器A中的捕捉通道x使能位组中使能独立的捕捉通道||
|8.If desired, enable inversion of the waveform output or IO pin input signal for individual channels via the Invert Enable bit group in the Drive Control register (DRVCTRL.INVEN)..|8.如果需要，可通过驱动控制寄存器（DRVCTRL.INVEN）中的取反使能位组来反转单个通道的波形输出或IO引脚输入信号。||

#### 48.6.2.2 启用，禁用和重置
| 英文 | 中文 | 说明 | 
| :------ | :----- | :----- |
|1.The TC is enabled by writing a '1' to the Enable bit in the Control A register (CTRLA.ENABLE). The TC is disabled by writing a zero to CTRLA.ENABLE.|1.通过向控制寄存器（CTRLA.ENABLE）中的使能位写入'1'使能TC。 通过将零写入CTRLA.ENABLE来禁用TC。||
|2.The TC is reset by writing a '1' to the Software Reset bit in the Control A register (CTRLA.SWRST). All registers in the TC, except DBGCTRL, will be reset to their initial state. Refer to the CTRLA register for details.|2.通过向控制寄存器（CTRLA.SWRST）中的软件复位位写入'1'来复位TC。 所有TC中除DBGCTRL外的寄存器将被重置为初始状态。 请参阅CTRLA注册细节。||
|3.The TC should be disabled before the TC is reset in order to avoid undefined behavior |3.在TC重置之前TC应该被禁用，以避免未定义的行为||


#### 48.6.2.3 预分频器选择
| 英文 | 中文 | 说明 | 
| :------ | :----- | :----- |
|The GCLK_TCx is fed into the internal prescaler|GCLK_TCx被送入内部预分频器||
|The prescaler consists of a counter that counts up to the selected prescaler value, whereupon the output of the prescaler toggles|预分频器由一个计数器组成，计数器计数到所选预分频器值，然后预分频器的输出发生翻转||
|If the prescaler value is higher than one, the counter update condition can be optionally executed on the next GCLK_TCx clock pulse or the next prescaled clock pulse. For further details, refer to Prescaler(CTRLA.PRESCALER) and Counter Synchronization (CTRLA.PRESYNC) description.|如果预分频器值大于1，则可以选择对下一个GCLK_TCx时钟脉冲或下一个预分频时钟脉冲执行计数器更新条件。 有关更多详细信息，请参阅预分频器（CTRLA.PRESCALER）和计数器同步（CTRLA.PRESYNC）说明。||
|Prescaler outputs from 1 to 1/1024 are available. For a complete list of available prescaler outputs, see the register description for the Prescaler bit group in the Control A register (CTRLA.PRESCALER).|预分频器输出从1到1/1024可设。 有关可用预分频器输出的完整列表，请参见控制寄存器（CTRLA.PRESCALER）中预分频比特组的寄存器说明。||
```
Note:  When counting events, the prescaler is bypassed.
The joint stream of prescaler ticks and event action ticks is called CLK_TC_CNT
备注
注：计数事件时，预分频器被旁路。
预分频器滴答和事件动作滴答的联合流称为CLK_TC_CNT
```
![images](https://github.com/yuchengstudio/SAME54/blob/master/Timer_Counter/pictures/timer003.jpg)


#### 48.6.2.4 计数器模式
The counter mode is selected by the Mode bit group in the Control A register (CTRLA.MODE). By default,the counter is enabled in the 16-bit counter resolution. Three counter resolutions are available
计数器模式由控制寄存器（CTRLA.MODE）中的模式位组选择。 默认情况下，计数器在16位计数器分辨率下启用。 有三种计数器分辨率可用：











